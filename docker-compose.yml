services:
  res_chatbot:
    # Build từ thư mục python giống như lệnh: cd python && docker build .
    build:
      context: ./python
      dockerfile: Dockerfile

    image: nlp222
    container_name: res_rag_container

    # Giữ terminal active để debug nếu cần
    stdin_open: true
    tty: true

    # Map thư mục cho giống logic của util.sh
    volumes:
      # 1. Map Input: Giống lệnh -v $S_IN:/nlp/input
      - ./input:/nlp/input

      # 2. Map Output: util.sh lưu vào folder MSSV/output (2211522/output)
      # Nếu thư mục chưa có, docker sẽ tự tạo.
      - ./2211522/output:/nlp/output

      # 3. Map Source Code (Quan trọng):
      # Thay vì copy tĩnh (COPY . .), ta map folder python bên ngoài vào /nlp bên trong
      # để sửa code xong chạy lại được ngay mà không cần build lại image.
      - ./python:/nlp

      # Lưu ý: Không map models riêng lẻ nếu đã map cả folder python ở trên,
      # nhưng nếu muốn giữ cache model trong máy thật thì để dòng dưới cũng được:
      - ./python/models:/nlp/models

    # Biến môi trường (nếu cần thiết lập lại, dù Dockerfile đã có)
    environment:
      - HF_HOME=/nlp/models
